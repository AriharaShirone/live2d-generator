!function(){if(!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)&&window.WebGLRenderingContext){var resourcePath="https://cdn.jsdelivr.net/gh/fz6m/Private-web@50.2/static/",rainbowAnimation=["l2d-rainbow","l2d-jitter"],musicUrls=["http://music.163.com/song/media/outer/url?id=461301621.mp3","http://music.163.com/song/media/outer/url?id=460528.mp3","http://music.163.com/song/media/outer/url?id=34609107.mp3"],color="#FFF0F5",mediaInfo={title:"桃饱之声",artist:"fz6m",album:"Peach-Max",artwork:resourcePath+"music/img/artwork.png",artworkTpye:"image/png"},musicInited=!1,audio=null,hitokotoTimer=null,sleepyTimer=null,hideTimer=null,live2d=$("#landlord"),dragging=!1,iX,iY,bottom,localKey_hidden="live2d-hidden",utils_random=function(array){return array[Math.floor(Math.random()*array.length)]},utils_throttle=function(func,wait=2e3){var timeout;return function(){var context=this,args=arguments;timeout||(func.apply(context,args),timeout=setTimeout((function(){clearTimeout(timeout),timeout=null}),wait))}},utils_formatVar=function(text,context){var reg=/(\\)?\{([^\{\}\\]+)(\\)?\}/g;return text.replace(reg,(function(word,slash1,token,slash2){console.log("1"),(slash1||slash2)&&(word=word.replace(slash1,"").replace(slash2,""));for(var variables=token.replace(/\s/g,"").split("."),currentObject=context,i=0;i<variables.length;++i)if(!(currentObject=currentObject[variables[i]]))return word;return word.replace(token,currentObject).replace("{","").replace("}","")}))},utils_hitokotoClear=function(){clearInterval(hitokotoTimer),hitokotoTimer=null},utils_hitokotoStart=function(){hitokotoTimer||(hitokotoTimer=setInterval((function(){hitokoto()}),15e3))},utils_debounce=function(func,tip,wait=2e3){var timeout;return function(){var context=this;timeout&&clearTimeout(timeout);var callNow=!timeout;timeout=setTimeout(()=>{timeout=null},wait),callNow&&func.call(this,tip)}},utils_unSelection=function(){window.getSelection&&window.getSelection().removeAllRanges(),document.selection&&document.selection.empty()};start()}function start(){$(document).ready((function(){for(var materialList=[resourcePath+"model/histoire/histoire.1024/texture_00.png",resourcePath+"model/histoire/histoire.1024/texture_01.png",resourcePath+"model/histoire/histoire.1024/texture_02.png",resourcePath+"model/histoire/histoire.1024/texture_03.png"],images=[],loaded=0,loadingDelay=1300,loadBuffer=200,i=0;i<materialList.length;i++)images[i]=new Image,images[i].src=materialList[i],images[i].onload=function(){++loaded===materialList.length&&("true"==localStorage.getItem(localKey_hidden)?setTimeout((function(){$("#open-live2d").fadeIn(200)}),1300):setTimeout((function(){$("#landlord").fadeIn(200)}),1300),setTimeout((function(){loadlive2d("live2d",resourcePath+"model/histoire/model.json")}),1e3),initLive2d(),images=null)}}))}function formatInit(){String.prototype.formatVar=function(context){return utils_formatVar(this,context)}}function showMessage(text,timeout=5e3){Array.isArray(text)&&(text=utils_random(text)),$(".message").html(text),$(".message").fadeTo(200,1),resetLive2d(),hideMessage()}function hideMessage(timeout=5e3){hideTimer||(hideTimer=!0,setTimeout((function(){$(".message").fadeTo(200,0),hideTimer=!1}),timeout))}function onDevtools(){var element=new Image;Object.defineProperty(element,"id",{get:function(){showMessage("哈哈，你打开了控制台，是想要看看我的秘密吗？")}}),console.log(element)}function onCopy(){$(document).on("copy",(function(){showMessage("你都复制了些什么呀，转载要记得加上出处哦~~")}))}function onReferrer(){var homePath=document.location.protocol+"//"+window.document.location.hostname+"/",text=null;if(document.referrer){var referrer=document.createElement("a"),domain;switch(referrer.href=document.referrer,referrer.hostname.split(".")[1]){case"baidu":text='嗨！ 来自 百度搜索 的朋友！<br>欢迎访问<span style="color:#FFF0F5;">「 '+document.title.split(" - ")[0]+" 」</span>";break;case"so":text='嗨！ 来自 360搜索 的朋友！<br>欢迎访问<span style="color:#FFF0F5;">「 '+document.title.split(" - ")[0]+" 」</span>";break;case"google":text='嗨！ 来自 谷歌搜索 的朋友！<br>欢迎访问<span style="color:#FFF0F5;">「 '+document.title.split(" - ")[0]+" 」</span>";break;default:text='嗨！来自 <span style="color:#FFF0F5;">'+referrer.hostname+"</span> 的朋友！"}}else if(window.location.href==homePath){var now=(new Date).getHours();switch(now){case now>23||now<=5:text="你是夜猫子呀？这么晚还不睡觉，明天起的来嘛？";break;case now>5&&now<=7:text="早上好！一日之计在于晨，美好的一天就要开始了！";break;case now>7&&now<=11:text="上午好！工作顺利嘛，不要久坐，多起来走动走动哦！";break;case now>11&&now<=14:text="中午了，工作了一个上午，现在是午餐时间！";break;case now>14&&now<=17:text="午后很容易犯困呢，今天的目标完成了吗？";break;case now>17&&now<=19:text="傍晚了！窗外夕阳的景色很美丽呢，最美不过夕阳红~~";break;case now>19&&now<=21:text="晚上好，今天过得怎么样？";break;case now>21&&now<=23:text="已经这么晚了呀，早点休息吧，晚安~~";break;default:text="嗨~ 快来逗我玩吧！"}}else text='欢迎阅读<span style="color:#FFF0F5;">「 '+document.title.split(" - ")[0]+" 」</span>";showMessage(text,1e4)}function hitokoto(){var hitokotoPath="https://v1.hitokoto.cn/";function checkSleep(){"1"!==sessionStorage.getItem("Sleepy")&&(showMessage("你回来啦~"),clearInterval(sleepyTimer),sleepyTimer=null)}if("1"!==sessionStorage.getItem("Sleepy"))$.getJSON(hitokotoPath,(function(res){res&&showMessage(res.hitokoto)}));else{if(sleepyTimer)return;sleepyTimer=setInterval((function(){checkSleep()}),200)}}function hitokotoButton(){utils_hitokotoClear(),hitokoto(),setTimeout(utils_hitokotoStart,5e3)}function currentTip(){$.ajax({cache:!0,url:resourcePath+"message.json",dataType:"json",success:function(result){function clickEvent(tips){utils_hitokotoClear();var text=tips.text;Array.isArray(text)&&(text=utils_random(text)),showMessage(text=text.formatVar({text:$(this).text()})),setTimeout(utils_hitokotoStart(),1e4)}$.each(result.mouseover,(function(index,tips){$(tips.selector).mouseover((function(){utils_hitokotoClear();var text=tips.text;Array.isArray(text)&&(text=utils_random(text)),showMessage(text=text.formatVar({text:$(this).text()}))})),$(tips.selector).mouseout((function(){utils_hitokotoStart()}))})),$.each(result.click,(function(index,tips){$(tips.selector).click(utils_debounce(clickEvent,tips,2e3))}))}})}function resetLive2d(){$("#live_talk").val("1")}function onDrag(){live2d.mousedown((function(e){return utils_unSelection(),dragging=!0,iX=e.clientX-this.offsetLeft,iY=e.clientY,bottom=+live2d.css("bottom").replace("px",""),!1})),document.onmousemove=function(e){if(dragging){var e=e||window.event;return live2d.css({left:e.clientX-iX+"px",bottom:bottom+iY-e.clientY+"px"}),!1}},$(document).mouseup((function(e){dragging=!1,e.cancelBubble=!0}))}function initLive2d(){function musicMediaSessionInit(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("nexttrack",(function(){musicPlay()})),navigator.mediaSession.setActionHandler("previoustrack",(function(){musicPlay()})),navigator.mediaSession.setActionHandler("pause",(function(){audio.pause(),navigator.mediaSession.playbackState="paused"})),navigator.mediaSession.setActionHandler("play",(function(){audio.play(),$("#music-button").addClass("play")})))}function musicPlay(){if(audio&&(audio.pause(),audio=null),(audio=new Audio(utils_random(musicUrls))).load(),"mediaSession"in navigator){const metadata={title:mediaInfo.title,artist:mediaInfo.artist,album:mediaInfo.album+"(^・ω・^§)",artwork:[{src:mediaInfo.artwork,sizes:"128x128",type:mediaInfo.artworkTpye}]};navigator.mediaSession.metadata=new window.MediaMetadata(metadata),navigator.mediaSession.playbackState="playing"}audio.addEventListener("canplay",(function(){audio.volume=1,audio.play(),$("#music-button").addClass("play")})),audio.addEventListener("ended",(function(){musicPlay()})),audio.addEventListener("pause",(function(){$("#music-button").removeClass("play"),navigator.mediaSession.playbackState="paused"})),audio.addEventListener("error",(function(){audio.pause(),$("#music-button").removeClass("play"),showMessage("音乐似乎加载不出来了呢！")}))}$("#hide-button").on("click",(function(){if("true"==localStorage.getItem(localKey_hidden))return!1;localStorage.setItem(localKey_hidden,!0),$("#landlord").fadeOut(200),$("#open-live2d").delay(200).fadeIn(200)})),$("#open-live2d").on("click",(function(){if("true"!=localStorage.getItem(localKey_hidden))return!1;localStorage.setItem(localKey_hidden,!1),$("#open-live2d").fadeOut(200),$("#landlord").delay(200).fadeIn(200)})),$("#rainbow-button").on("click",(function(){if($("#rainbow-button").hasClass("jitter"))$("#rainbow-button").removeClass("jitter"),$("html").removeClass($("#rainbow-button").data("animation"));else{var animation=utils_random(rainbowAnimation);$("#rainbow-button").addClass("jitter"),$("html").addClass(animation),$("#rainbow-button").data("animation",animation)}})),musicUrls.length?$("#music-button").on("click",(function(){musicInited||(musicMediaSessionInit(),musicInited=!0),$("#music-button").hasClass("play")?audio.pause():audio?(audio.play(),$("#music-button").addClass("play")):musicPlay()})):$("#music-button").hide(),$("#talk-button").on("click",utils_throttle(hitokotoButton)),onDevtools(),onCopy(),onReferrer(),utils_hitokotoStart(),formatInit(),currentTip(),onDrag()}}();